// This is your Prisma schema file
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String     @id @default(cuid())
  email         String     @unique
  firstName     String?
  lastName      String?
  password      String
  picture       String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  proposals     Proposal[]
}

model Proposal {
  id                 String   @id @default(cuid())
  userId             String
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  clientName         String
  clientEmail        String
  clientCompany      String?
  projectTitle       String
  projectDescription String
  budget             String
  timeline           String
  startDate          String?
  deliverables       String?
  status             String   @default("draft")
  createdAt          DateTime @default(now())

  // AI-generated content fields
  executiveSummary    String
  scopeOfWork         String
  pricingBreakdown    String
  timelineDetails     String
  termsAndConditions  String

  // Digital signature fields
  freelancerSignatureType String?  // 'drawn' | 'typed'
  freelancerSignatureData String? // Base64 image (drawn) or text (typed)
  freelancerSignedAt     DateTime?

  clientSignatureType String?
  clientSignatureData String?
  clientSignedAt     DateTime?

  signatureStatus String  @default("not_started") // 'not_started' | 'pending_client' | 'signed'
  signatureToken String? // Unique token for client verification

  // Security fields
  verificationCode      String?  // 6-digit code for email verification
  verificationCodeExpiry DateTime? // Code expires after 1 hour
  clientEmailVerified   Boolean  @default(false) // Has client verified email?
  contentHash           String?  // SHA-256 hash of proposal content
  termsAccepted         Boolean  @default(false) // Client accepted terms?
  ipAddress             String?  // Client IP for audit trail
  userAgent             String?  // Client browser/device info
}
